!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@angular/material/button"),require("@angular/material/checkbox"),require("@angular/material/dialog"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/progress-spinner"),require("@angular/material/tooltip"),require("rxjs"),require("rxjs/operators"),require("html2canvas"),require("@angular/cdk/overlay")):"function"==typeof define&&define.amd?define("ng-feedback",["exports","@angular/core","@angular/common","@angular/forms","@angular/material/button","@angular/material/checkbox","@angular/material/dialog","@angular/material/icon","@angular/material/input","@angular/material/progress-spinner","@angular/material/tooltip","rxjs","rxjs/operators","html2canvas","@angular/cdk/overlay"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ng-feedback"]={},e.ng.core,e.ng.common,e.ng.forms,e.ng.material.button,e.ng.material.checkbox,e.ng.material.dialog,e.ng.material.icon,e.ng.material.input,e.ng.material.progressSpinner,e.ng.material.tooltip,e.rxjs,e.rxjs.operators,e.html2canvas,e.ng.cdk.overlay)}(this,(function(e,t,n,o,i,a,r,s,l,c,d,h,p,g,u){"use strict";function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=f(g),v=function(){},b=function(){this.windowScrollY=window.scrollY,this.windowScrollX=window.scrollX},w=function(){function e(){this.initialVariables={},this.highlightedColor="yellow",this.hiddenColor="black",this.screenshotCanvasSource=new h.Subject,this.screenshotCanvas$=this.screenshotCanvasSource.asObservable(),this.feedbackSource=new h.Subject,this.feedback$=this.feedbackSource.asObservable(),this.isDraggingToolbarSource=new h.Subject,this.isDraggingToolbar$=this.isDraggingToolbarSource.asObservable()}return e.prototype.initScreenshotCanvas=function(){var e=this,t=document.body;m.default(t,{logging:!1,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop,allowTaint:!0,useCORS:!0}).then((function(t){e.screenshotCanvasSource.next(t)}))},e.prototype.setCanvas=function(e){this.screenshotCanvasSource.next(e)},e.prototype.setFeedback=function(e){this.feedbackSource.next(e)},e.prototype.setIsDraggingToolbar=function(e){this.isDraggingToolbarSource.next(e)},e.prototype.getImgEle=function(e){var t=e.toDataURL("image/png"),n=document.createElement("img");return n.setAttribute("src",t),Object.assign(n.style,{position:"absolute",top:"50%",right:"0",left:"0",margin:"0 auto",maxHeight:"100%",maxWidth:"100%",transform:"translateY(-50%)"}),n},e.prototype.hideBackDrop=function(){document.getElementsByClassName("dialogBackDrop")[0].style.backgroundColor="initial"},e.prototype.showBackDrop=function(){var e=document.getElementsByClassName("dialogBackDrop")[0];e.getAttribute("data-html2canvas-ignore")||e.setAttribute("data-html2canvas-ignore","true"),e.style.backgroundColor="rgba(0, 0, 0, .288)"},e}();w.ɵfac=function(e){return new(e||w)},w.ɵprov=t.ɵɵdefineInjectable({token:w,factory:w.ɵfac}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(w,[{type:t.Injectable}],null,null);var x=["toggleMove"],y=function(e){return{"toggle-decorator":e}};function C(e,n){if(1&e&&(t.ɵɵnamespaceSVG(),t.ɵɵelementStart(0,"svg",19),t.ɵɵelement(1,"path",20),t.ɵɵelementEnd()),2&e){var o=t.ɵɵnextContext();t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(1,y,!o.isSwitch))}}function M(e,n){if(1&e&&(t.ɵɵnamespaceSVG(),t.ɵɵelementStart(0,"svg",19),t.ɵɵelement(1,"path",20),t.ɵɵelementEnd()),2&e){var o=t.ɵɵnextContext();t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(1,y,o.isSwitch))}}var k=function(e){return{"deepen-color":e}},S=function(){function e(e,n){this.el=e,this.feedbackService=n,this.manipulate=new t.EventEmitter,this.disableToolbarTips=!1,this.isSwitch=!1,this.isDragging=!1,this.vars={},this.vars=n.initialVariables}return e.prototype.ngAfterViewInit=function(){var e=this.el.nativeElement.style;e.position="absolute",e.left="43%",e.top="1em",this.addDragListenerOnMoveBtn()},e.prototype.ngOnChanges=function(){this.isSwitch=this.drawColor!==this.feedbackService.highlightedColor},e.prototype.done=function(){this.manipulate.emit("done")},e.prototype.toggleHighlight=function(){this.isSwitch=!1,this.manipulate.emit(this.feedbackService.highlightedColor)},e.prototype.toggleHide=function(){this.isSwitch=!0,this.manipulate.emit(this.feedbackService.hiddenColor)},e.prototype.addDragListenerOnMoveBtn=function(){var e=this,t=h.fromEvent(this.toggleMoveBtn.nativeElement,"mouseup"),n=h.fromEvent(document.documentElement,"mousemove");h.fromEvent(this.toggleMoveBtn.nativeElement,"mousedown").pipe(p.mergeMap((function(o){e.feedbackService.setIsDraggingToolbar(!0);var i=o.offsetX,a=o.offsetY;return e.disableToolbarTips=!0,e.isDragging=!0,n.pipe(p.map((function(e){return e.preventDefault(),{left:e.clientX-i,top:e.clientY-a}})),p.finalize((function(){e.isDragging=!1,e.disableToolbarTips=!1,e.feedbackService.setIsDraggingToolbar(!1)})),p.takeUntil(t))}))).subscribe((function(t){e.el.nativeElement.style.left=t.left+"px",e.el.nativeElement.style.top=t.top+"px"}))},e}();function T(e,n){if(1&e){var o=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"span",2),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(o),t.ɵɵnextContext().onClose()})),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",3),t.ɵɵelement(2,"path",4),t.ɵɵelementEnd(),t.ɵɵelementEnd()}}S.ɵfac=function(e){return new(e||S)(t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(w))},S.ɵcmp=t.ɵɵdefineComponent({type:S,selectors:[["feedback-toolbar"]],viewQuery:function(e,n){if(1&e&&t.ɵɵviewQuery(x,3),2&e){var o;t.ɵɵqueryRefresh(o=t.ɵɵloadQuery())&&(n.toggleMoveBtn=o.first)}},inputs:{drawColor:"drawColor"},outputs:{manipulate:"manipulate"},features:[t.ɵɵNgOnChangesFeature],decls:23,vars:15,consts:[["exclude-rect","true",1,"toolbar"],[1,"move-toolbar",3,"matTooltip","matTooltipDisabled"],["toggleMove",""],["focusable","false","aria-label","Drag","fill","#BDBDBD","height","56","width","16","viewBox","-2 2 12 12"],["cx","1.5","cy","1.5","r","1.5"],["cx","1.5","cy","7.5","r","1.5"],["cx","1.5","cy","13.5","r","1.5"],["cx","6.5","cy","1.5","r","1.5"],["cx","6.5","cy","7.5","r","1.5"],["cx","6.5","cy","13.5","r","1.5"],[1,"highlight-toggle",3,"matTooltip","matTooltipDisabled","ngClass","click"],["highlightBtn",""],[1,"toggle"],["focusable","false","aria-label","","viewBox","0 0 24 24","height","36","width","36","fill","#ffd740"],["d","M3 3h18v18H3z"],["focusable","false","aria-label","","fill","#757575","viewBox","0 0 24 24","height","36","width","36",3,"ngClass",4,"ngIf"],[1,"hide-toggle",3,"matTooltip","matTooltipDisabled","ngClass","click"],["focusable","false","aria-label","","viewBox","0 0 24 24","height","36","width","36","fill","#000"],["mat-button","",1,"merge-button",3,"click"],["focusable","false","aria-label","","fill","#757575","viewBox","0 0 24 24","height","36","width","36",3,"ngClass"],["d","M21 17h-2.58l2.51 2.56c-.18.69-.73 1.26-1.41 1.44L17 18.5V21h-2v-6h6v2zM19 7h2v2h-2V7zm2-2h-2V3.08c1.1 0 2 .92 2 1.92zm-6-2h2v2h-2V3zm4 8h2v2h-2v-2zM9 21H7v-2h2v2zM5 9H3V7h2v2zm0-5.92V5H3c0-1 1-1.92 2-1.92zM5 17H3v-2h2v2zM9 5H7V3h2v2zm4 0h-2V3h2v2zm0 16h-2v-2h2v2zm-8-8H3v-2h2v2zm0 8.08C3.9 21.08 3 20 3 19h2v2.08z"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"div",1,2),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(3,"svg",3),t.ɵɵelement(4,"circle",4),t.ɵɵelement(5,"circle",5),t.ɵɵelement(6,"circle",6),t.ɵɵelement(7,"circle",7),t.ɵɵelement(8,"circle",8),t.ɵɵelement(9,"circle",9),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵnamespaceHTML(),t.ɵɵelementStart(10,"button",10,11),t.ɵɵlistener("click",(function(){return n.toggleHighlight()})),t.ɵɵelementStart(12,"span",12),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(13,"svg",13),t.ɵɵelement(14,"path",14),t.ɵɵelementEnd(),t.ɵɵtemplate(15,C,2,3,"svg",15),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵnamespaceHTML(),t.ɵɵelementStart(16,"button",16),t.ɵɵlistener("click",(function(){return n.toggleHide()})),t.ɵɵelementStart(17,"span",12),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(18,"svg",17),t.ɵɵelement(19,"path",14),t.ɵɵelementEnd(),t.ɵɵtemplate(20,M,2,3,"svg",15),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵnamespaceHTML(),t.ɵɵelementStart(21,"button",18),t.ɵɵlistener("click",(function(){return n.done()})),t.ɵɵtext(22),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("matTooltip",n.vars.moveToolbarTip)("matTooltipDisabled",n.disableToolbarTips),t.ɵɵadvance(9),t.ɵɵproperty("matTooltip",n.vars.highlightTip)("matTooltipDisabled",n.disableToolbarTips)("ngClass",t.ɵɵpureFunction1(11,k,!n.isSwitch)),t.ɵɵadvance(5),t.ɵɵproperty("ngIf",!n.isSwitch),t.ɵɵadvance(1),t.ɵɵproperty("matTooltip",n.vars.hideTip)("matTooltipDisabled",n.disableToolbarTips)("ngClass",t.ɵɵpureFunction1(13,k,n.isSwitch)),t.ɵɵadvance(4),t.ɵɵproperty("ngIf",n.isSwitch),t.ɵɵadvance(2),t.ɵɵtextInterpolate(n.vars.editDoneLabel))},directives:[d.MatTooltip,n.NgClass,n.NgIf,i.MatButton],styles:[".toolbar[_ngcontent-%COMP%]{align-items:center;background-color:#fff;border-radius:2px;bottom:0;box-shadow:0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12),0 11px 15px -7px rgba(0,0,0,.2);cursor:pointer;display:-webkit-inline-flex;flex-direction:row;height:56px;left:0;margin:0 auto;min-width:232px;overflow:visible;pointer-events:auto;position:absolute;right:0;top:25%;width:228px;z-index:999}.move-toolbar[_ngcontent-%COMP%]{cursor:-webkit-grab;height:56px;padding:0 12px;position:relative}.move-toolbar[_ngcontent-%COMP%]:active{cursor:-webkit-grabbing}.toggle[_ngcontent-%COMP%]{display:inline-block;height:36px;position:relative;width:36px}.toggle-decorator[_ngcontent-%COMP%]{left:0;position:absolute;top:0}.highlight-toggle[_ngcontent-%COMP%]{align-items:center;background-color:#fff;border:none;box-sizing:border-box;cursor:pointer;display:-webkit-flex;height:56px;justify-content:center;outline:none;padding:10px;pointer-events:auto;position:relative;width:56px}.deepen-color[_ngcontent-%COMP%]{background-color:#e0e0e0!important}.hide-toggle[_ngcontent-%COMP%]{align-items:center;background-color:#fff;border:none;box-sizing:border-box;cursor:pointer;display:-webkit-flex;height:56px;justify-content:center;outline:none;padding:10px;pointer-events:auto;position:relative;width:56px}.merge-button[_ngcontent-%COMP%]{color:#4285f4;margin:0 10px!important;min-width:56px;padding:0!important}"]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(S,[{type:t.Component,args:[{selector:"feedback-toolbar",templateUrl:"./feedback-toolbar.component.html",styleUrls:["./feedback-toolbar.component.css"]}]}],(function(){return[{type:t.ElementRef},{type:w}]}),{drawColor:[{type:t.Input}],manipulate:[{type:t.Output}],toggleMoveBtn:[{type:t.ViewChild,args:["toggleMove",{static:!0}]}]});var D=function(e,t,n,o){return{"left.px":e,"top.px":t,"width.px":n,"height.px":o}},E=function(e,t,n){return{highlight:e,hide:t,noHover:n}},R=function(){function e(e){this.feedbackService=e,this.close=new t.EventEmitter,this.showCloseTag=!1}return e.prototype.onMouseEnter=function(){this.showCloseTag=!1===this.noHover},e.prototype.onMouseLeave=function(){this.showCloseTag=!1},e.prototype.onClose=function(){this.close.emit()},e}();R.ɵfac=function(e){return new(e||R)(t.ɵɵdirectiveInject(w))},R.ɵcmp=t.ɵɵdefineComponent({type:R,selectors:[["feedback-rectangle"]],hostBindings:function(e,n){1&e&&t.ɵɵlistener("mouseenter",(function(){return n.onMouseEnter()}))("mouseleave",(function(){return n.onMouseLeave()}))},inputs:{rectangle:"rectangle",noHover:"noHover"},outputs:{close:"close"},decls:2,vars:12,consts:[["exclude-rect","true",1,"rect",3,"ngStyle","ngClass"],["exclude-rect","true","class","close",3,"click",4,"ngIf"],["exclude-rect","true",1,"close",3,"click"],["viewBox","0 0 1024 1024","width","16","height","16"],["d","M896 224l-96-96-288 288-288-288-96 96 288 288-288 288 96 96 288-288 288 288 96-96-288-288 288-288z"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵtemplate(1,T,3,0,"span",1),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("ngStyle",t.ɵɵpureFunction4(3,D,n.rectangle.startX,n.rectangle.startY,n.rectangle.width,n.rectangle.height))("ngClass",t.ɵɵpureFunction3(8,E,n.rectangle.color===n.feedbackService.highlightedColor,n.rectangle.color!==n.feedbackService.highlightedColor,n.noHover)),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.showCloseTag))},directives:[n.NgStyle,n.NgClass,n.NgIf],styles:[".rect[_ngcontent-%COMP%]{background:none;position:fixed;z-index:3}.highlight[_ngcontent-%COMP%]:not(.noHover):hover{background:rgba(55,131,249,.2);cursor:default}.hide[_ngcontent-%COMP%]{background-color:#000}.hide[_ngcontent-%COMP%]:not(.noHover):hover{background-color:rgba(31,31,31,.75)}.rect[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{-moz-user-select:none;-webkit-user-select:none;align-items:center;background:#fff;border-radius:50%;color:#999;cursor:pointer;display:flex;height:24px;justify-content:center;position:absolute;right:-12px;top:-12px;user-select:none;width:24px}"]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(R,[{type:t.Component,args:[{selector:"feedback-rectangle",templateUrl:"./feedback-rectangle.component.html",styleUrls:["./feedback-rectangle.component.css"]}]}],(function(){return[{type:w}]}),{rectangle:[{type:t.Input}],noHover:[{type:t.Input}],close:[{type:t.Output}],onMouseEnter:[{type:t.HostListener,args:["mouseenter"]}],onMouseLeave:[{type:t.HostListener,args:["mouseleave"]}]});var I=["screenshotParent"];function O(e,n){if(1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var o=t.ɵɵnextContext(2);t.ɵɵadvance(1),t.ɵɵtextInterpolate(o.vars.placeholder)}}function P(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",21),t.ɵɵnamespaceSVG(),t.ɵɵelementStart(1,"svg",22),t.ɵɵelement(2,"path",23),t.ɵɵelementEnd(),t.ɵɵnamespaceHTML(),t.ɵɵelementStart(3,"span",24),t.ɵɵtext(4),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e){var o=t.ɵɵnextContext(3);t.ɵɵadvance(4),t.ɵɵtextInterpolate(o.vars.editTip)}}function L(e,n){if(1&e){var o=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",17,18),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(o),t.ɵɵnextContext(2).expandDrawingBoard()})),t.ɵɵelement(2,"mat-spinner",19),t.ɵɵelement(3,"div"),t.ɵɵtemplate(4,P,5,1,"div",20),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext(2);t.ɵɵadvance(2),t.ɵɵproperty("diameter",30),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",!i.showSpinner)}}function H(e,n){if(1&e){var o=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",4),t.ɵɵelementStart(1,"div",5),t.ɵɵelementStart(2,"div",6),t.ɵɵtext(3),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"div",7),t.ɵɵelementStart(5,"div",8),t.ɵɵtemplate(6,O,2,1,"div",9),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"textarea",10),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(o),t.ɵɵnextContext().feedback.description=e})),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(8,"div",11),t.ɵɵelementStart(9,"mat-checkbox",12),t.ɵɵlistener("ngModelChange",(function(e){return t.ɵɵrestoreView(o),t.ɵɵnextContext().includeScreenshot=e}))("change",(function(){return t.ɵɵrestoreView(o),t.ɵɵnextContext().isIncludeScreenshot()})),t.ɵɵtext(10),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(11,L,5,2,"div",13),t.ɵɵelementStart(12,"mat-dialog-actions",14),t.ɵɵelementStart(13,"button",15),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(o),t.ɵɵnextContext().dialogRef.close()})),t.ɵɵtext(14),t.ɵɵelementEnd(),t.ɵɵelementStart(15,"button",16),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(o),t.ɵɵnextContext().dialogRef.close(!0)})),t.ɵɵtext(16),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(3),t.ɵɵtextInterpolate1(" ",i.vars.title," "),t.ɵɵadvance(3),t.ɵɵproperty("ngIf",""==i.feedback.description),t.ɵɵadvance(1),t.ɵɵproperty("ngModel",i.feedback.description),t.ɵɵadvance(2),t.ɵɵproperty("ngModel",i.includeScreenshot),t.ɵɵadvance(1),t.ɵɵtextInterpolate(i.vars.checkboxLabel),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.includeScreenshot),t.ɵɵadvance(3),t.ɵɵtextInterpolate(i.vars.cancelLabel),t.ɵɵadvance(2),t.ɵɵtextInterpolate(i.vars.sendLabel)}}function z(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",28),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var o=t.ɵɵnextContext(2);t.ɵɵadvance(1),t.ɵɵtextInterpolate1(" ",o.vars.drawRectTip," ")}}function V(e,n){if(1&e){var o=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",25),t.ɵɵtemplate(1,z,2,1,"div",26),t.ɵɵelementStart(2,"feedback-toolbar",27),t.ɵɵlistener("manipulate",(function(e){return t.ɵɵrestoreView(o),t.ɵɵnextContext().manipulate(e)})),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.showToolbarTips),t.ɵɵadvance(1),t.ɵɵproperty("drawColor",i.drawColor)}}function _(e,n){if(1&e){var o=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div"),t.ɵɵelementStart(1,"feedback-rectangle",29),t.ɵɵlistener("close",(function(){t.ɵɵrestoreView(o);var e=n.index;return t.ɵɵnextContext().closeRect(e)})),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var i=n.$implicit,a=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("rectangle",i)("noHover",!a.showToolbar||a.isDrawingRect)}}var B=function(e){return{pointerCursor:e}},j=function(){function e(e,t,n,o){this.dialogRef=e,this.feedbackService=t,this.detector=n,this.el=o,this.showToolbar=!1,this.vars={},this.feedback=new v,this.includeScreenshot=!0,this.showSpinner=!0,this.showToolbarTips=!0,this.drawColor=this.feedbackService.highlightedColor,this.rectangles=[],this.scrollWidth=document.documentElement.scrollWidth,this.scrollHeight=document.documentElement.scrollHeight,this.elCouldBeHighlighted=["button","a","span","em","i","h1","h2","h3","h4","h5","h6","p","strong","small","sub","sup","b","time","img","video","input","label","select","textarea","article","summary","section"],this.isDrawingRect=!1,this.feedback=new v,this.feedback.description="",this.vars=this.feedbackService.initialVariables}return e.prototype.ngAfterViewInit=function(){var e=this;this.feedbackService.screenshotCanvas$.subscribe((function(t){e.showSpinner=!1,e.feedback.screenshot=t.toDataURL("image/png"),e.screenshotEle=e.feedbackService.getImgEle(t),e.appendScreenshot()})),this.feedbackService.isDraggingToolbar$.subscribe((function(t){t?e.destroyCanvasListeners():e.addCanvasListeners()})),this.dialogRef.afterClosed().subscribe((function(t){!0===t&&e.feedbackService.setFeedback(e.feedback)})),this.feedbackService.showBackDrop()},e.prototype.expandDrawingBoard=function(){this.showToolbar=!0,this.drawCanvas||(this.detector.detectChanges(),this.initBackgroundCanvas(),this.feedbackService.hideBackDrop()),this.addCanvasListeners(),this.el.nativeElement.appendChild(this.drawCanvas),this.feedbackService.hideBackDrop(),console.log("expand the board")},e.prototype.onEscapeKeyDownHandler=function(e){this.showToolbar=!1,this.includeScreenshot=!0,this.detector.detectChanges(),this.dialogRef.close("key down esc to close")},e.prototype.manipulate=function(e){"done"===e?(this.showToolbarTips=!1,this.showSpinner=!0,this.destroyCanvasListeners(),this.showToolbar=!1,this.detector.detectChanges(),this.feedbackService.initScreenshotCanvas()):this.startDraw(e)},e.prototype.startDraw=function(e){this.drawColor=e},e.prototype.isIncludeScreenshot=function(){this.includeScreenshot?(this.detector.detectChanges(),this.showSpinner=!1,this.appendScreenshot(),this.feedback.screenshot=this.screenshotEle.getAttribute("src")):(delete this.feedback.screenshot,this.showSpinner=!0)},e.prototype.appendScreenshot=function(){this.screenshotParent&&this.screenshotParent.nativeElement.appendChild(this.screenshotEle)},e.prototype.initBackgroundCanvas=function(){this.drawCanvas=document.getElementById("draw-canvas"),this.drawCanvas.style.height=this.scrollHeight+"",this.drawCanvas.style.width=this.scrollWidth+"",this.drawCanvas.height=this.scrollHeight,this.drawCanvas.width=this.scrollWidth,this.drawContainerRect()},e.prototype.drawContainerRect=function(){var e=this.drawCanvas.getContext("2d"),t=this.scrollWidth,n=this.scrollHeight;e.beginPath(),e.fillStyle="rgba(0,0,0,0.3)",e.clearRect(0,0,t,n),e.fillRect(0,0,t,n)},e.prototype.drawRectangle=function(e){var t=this,n=this.drawCanvas.getContext("2d");n.lineJoin="round",n.beginPath(),e.color===this.feedbackService.hiddenColor?(n.fillStyle="rgba(31, 31, 31, 0.75)",n.fillRect(e.startX,e.startY,e.width,e.height),n.rect(e.startX,e.startY,e.width,e.height)):(n.clearRect(e.startX,e.startY,e.width,e.height),n.lineWidth=5,n.strokeStyle=e.color,n.rect(e.startX,e.startY,e.width,e.height),n.stroke(),n.clearRect(e.startX,e.startY,e.width,e.height),this.rectangles.forEach((function(e){e.color===t.feedbackService.highlightedColor&&n.clearRect(e.startX,e.startY,e.width,e.height)})))},e.prototype.addCanvasListeners=function(){var e=h.fromEvent(document.documentElement,"mouseup"),t=h.fromEvent(document.documentElement,"mousemove"),n=h.fromEvent(document.documentElement,"mousedown"),o=h.fromEvent(window,"scroll");this.manuallyDrawRect(n,t,e),this.autoDrawRect(t),this.changeRectPosition(o)},e.prototype.changeRectPosition=function(e){var t=this;e.subscribe((function(e){var n=window.scrollX,o=window.scrollY;t.rectangles.forEach((function(e){e.startY=e.startY-(o-e.windowScrollY),e.startX=e.startX-(n-e.windowScrollX),e.windowScrollY=o,e.windowScrollX=n})),t.drawPersistCanvasRectangles()}),(function(e){return console.error(e)}))},e.prototype.destroyCanvasListeners=function(){this.manuallyDrawRect$&&this.manuallyDrawRect$.unsubscribe(),this.autoDrawRect$&&this.autoDrawRect$.unsubscribe()},e.prototype.manuallyDrawRect=function(e,t,n){var o=this,i=e.pipe(p.mergeMap((function(e){o.showToolbarTips&&(o.showToolbarTips=!1),o.autoDrawRect$.unsubscribe(),o.isDrawingRect=!0;var i=new b;return i.startX=e.clientX,i.startY=e.clientY,i.color=o.drawColor,t.pipe(p.map((function(t){return i.width=t.clientX-e.clientX,i.height=t.clientY-e.clientY,i})),p.finalize((function(){if(void 0===i.width||void 0===i.height||0===i.width||0===i.height){var n=o.drawTempCanvasRectangle(e);n&&o.rectangles.push(n)}else i.height<0&&(i.startY=i.startY+i.height,i.height=Math.abs(i.height)),i.width<0&&(i.startX=i.startX+i.width,i.width=Math.abs(i.width)),o.rectangles.push(i);o.drawPersistCanvasRectangles(),o.autoDrawRect(t),o.isDrawingRect=!1})),p.takeUntil(n))})));this.manuallyDrawRect$=i.subscribe((function(e){o.drawPersistCanvasRectangles(),o.drawRectangle(e)}))},e.prototype.autoDrawRect=function(e){var t=this;this.autoDrawRect$=e.subscribe({next:function(e){t.drawPersistCanvasRectangles(),t.drawTempCanvasRectangle(e)},error:function(e){return console.error("something wrong occurred: "+e)}})},e.prototype.drawPersistCanvasRectangles=function(){var e=this;this.drawContainerRect(),this.rectangles.forEach((function(t){e.drawRectangle(t)}))},e.prototype.drawTempCanvasRectangle=function(e){var t=null,n=e.clientX,o=e.clientY,i=document.elementsFromPoint(n,o),a=i[2];if(!this.isExcludeRect(i)&&a&&this.elCouldBeHighlighted.indexOf(a.nodeName.toLowerCase())>-1){t=new b;var r=a.getBoundingClientRect();this.drawCanvas.style.cursor="pointer",Object.assign(t,{startX:r.left,startY:r.top,width:r.width,height:r.height,color:this.drawColor}),this.drawRectangle(t)}else this.drawCanvas.style.cursor="crosshair";return t},e.prototype.closeRect=function(e){this.rectangles.splice(e,1),this.drawPersistCanvasRectangles()},e.prototype.isExcludeRect=function(e){return e.some((function(e){return"true"===e.getAttribute("exclude-rect")}))},e}();j.ɵfac=function(e){return new(e||j)(t.ɵɵdirectiveInject(r.MatDialogRef),t.ɵɵdirectiveInject(w),t.ɵɵdirectiveInject(t.ChangeDetectorRef),t.ɵɵdirectiveInject(t.ElementRef))},j.ɵcmp=t.ɵɵdefineComponent({type:j,selectors:[["feedback-dialog"]],viewQuery:function(e,n){if(1&e&&t.ɵɵviewQuery(I,1),2&e){var o;t.ɵɵqueryRefresh(o=t.ɵɵloadQuery())&&(n.screenshotParent=o.first)}},hostBindings:function(e,n){1&e&&t.ɵɵlistener("keydown.escape",(function(e){return n.onEscapeKeyDownHandler(e)}),!1,t.ɵɵresolveDocument)},decls:4,vars:6,consts:[["class","dialog","data-html2canvas-ignore","true",4,"ngIf"],["data-html2canvas-ignore","true",4,"ngIf"],[4,"ngFor","ngForOf"],["id","draw-canvas",1,"drawCanvas",3,"ngClass"],["data-html2canvas-ignore","true",1,"dialog"],[1,"dialog-title"],[1,"title-font"],[1,"dialog-content"],[1,"description-tips"],[4,"ngIf"],["autofocus","",1,"description",3,"ngModel","ngModelChange"],[1,"screenshot-checkbox"],[3,"ngModel","ngModelChange","change"],["class","screenshot-content",3,"click",4,"ngIf"],["align","end",1,"dialog-actions"],["mat-button","",1,"action-button",3,"click"],["mat-button","",1,"submit-button","action-button",3,"click"],[1,"screenshot-content",3,"click"],["screenshotParent",""],[1,"loading",3,"diameter"],["class","screenshot-tips",4,"ngIf"],[1,"screenshot-tips"],["focusable","false","aria-label","","viewBox","0 0 24 24"],["d","M21 17h-2.58l2.51 2.56c-.18.69-.73 1.26-1.41 1.44L17 18.5V21h-2v-6h6v2zM19 7h2v2h-2V7zm2-2h-2V3.08c1.1 0 2 .92 2 1.92zm-6-2h2v2h-2V3zm4 8h2v2h-2v-2zM9 21H7v-2h2v2zM5 9H3V7h2v2zm0-5.92V5H3c0-1 1-1.92 2-1.92zM5 17H3v-2h2v2zM9 5H7V3h2v2zm4 0h-2V3h2v2zm0 16h-2v-2h2v2zm-8-8H3v-2h2v2zm0 8.08C3.9 21.08 3 20 3 19h2v2.08z"],[1,"screenshot-tips-content"],["data-html2canvas-ignore","true"],["class","toolbar-tips",4,"ngIf"],[3,"drawColor","manipulate"],[1,"toolbar-tips"],[3,"rectangle","noHover","close"]],template:function(e,n){1&e&&(t.ɵɵtemplate(0,H,17,8,"div",0),t.ɵɵtemplate(1,V,3,2,"div",1),t.ɵɵtemplate(2,_,2,2,"div",2),t.ɵɵelement(3,"canvas",3)),2&e&&(t.ɵɵproperty("ngIf",!n.showToolbar),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.showToolbar),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",n.rectangles),t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(4,B,!n.showToolbar)))},directives:[n.NgIf,n.NgForOf,n.NgClass,o.DefaultValueAccessor,o.NgControlStatus,o.NgModel,a.MatCheckbox,r.MatDialogActions,i.MatButton,c.MatSpinner,S,R],styles:[".dialog[_ngcontent-%COMP%]{background-color:#fff;position:relative;width:360px;z-index:1000}.dialog-title[_ngcontent-%COMP%]{background-color:#607d8b;color:#fff;height:56px}.title-font[_ngcontent-%COMP%]{color:#fff;float:left;font-family:Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-size:20px;font-stretch:normal;font-style:normal;font-variant:normal;font-weight:300;line-height:56px;margin:0;padding:0 16px}.dialog-content[_ngcontent-%COMP%]{display:-webkit-flex;flex-grow:1;height:200px;position:relative}.description[_ngcontent-%COMP%]{border:none;box-shadow:none;box-sizing:border-box;color:#212121;flex-grow:1;height:inherit;max-width:100%;outline:none;resize:none;width:100%}.description[_ngcontent-%COMP%], .description-tips[_ngcontent-%COMP%]{font-family:Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-size:16px;font-stretch:normal;font-style:normal;font-variant:normal;font-weight:400;line-height:normal;padding:18px 16px 0}.description-tips[_ngcontent-%COMP%]{color:#bdbdbd;display:block;left:0;position:absolute;right:0}.screenshot-checkbox[_ngcontent-%COMP%]{background-color:#f8f8f8;display:flex;flex-direction:column;height:40px;justify-content:center;padding:0 16px}.screenshot-content[_ngcontent-%COMP%]{background:#ededed none;border:none;cursor:pointer;display:block;height:192px;overflow:hidden;padding:0;position:relative;text-align:center;width:100%}.screenshot-tips[_ngcontent-%COMP%]{align-items:center;background-color:hsla(0,0%,97.3%,.6);border-radius:4px;bottom:0;box-sizing:border-box;display:-webkit-flex;flex-direction:column;justify-content:center;left:0;margin:0 auto;min-height:112px;position:absolute;right:0;top:50%;transform:translateY(-50%);width:224px;z-index:5}.screenshot-content[_ngcontent-%COMP%]:hover   .screenshot-tips[_ngcontent-%COMP%]{background-color:hsla(0,0%,97.3%,.8)}.screenshot-content[_ngcontent-%COMP%]:hover   .screenshot-tips-content[_ngcontent-%COMP%]{color:#4285f4}.screenshot-content[_ngcontent-%COMP%]:hover   svg[_ngcontent-%COMP%]{color:#4285f4;fill:currentColor}.screenshot-tips[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#757575;fill:currentColor;height:48px;width:48px}.screenshot-tips-content[_ngcontent-%COMP%]{color:#757575;font-family:Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-size:14px;font-weight:400;line-height:20px;margin-top:12px}.dialog-actions[_ngcontent-%COMP%]{border-top:1px solid #e0e0e0}.submit-button[_ngcontent-%COMP%]{color:#4285f4;margin-left:5px!important;margin-right:8px!important}.action-button[_ngcontent-%COMP%]{font-size:14px;font-stretch:normal;font-style:normal;font-variant:normal;font-weight:500;height:35px;line-height:normal;margin:10px 0;min-width:75px;padding:0 8px;position:relative}.loading[_ngcontent-%COMP%]{bottom:0;left:0;margin:0 auto;position:absolute;right:0;top:45%}.mat-dialog-actions[_ngcontent-%COMP%]{padding:0!important}  .feedbackDialog .mat-dialog-container{background-color:hsla(0,0%,100%,0);box-shadow:none;overflow:visible;padding:0}.toolbar-tips[_ngcontent-%COMP%]{-webkit-animation:cssAnimation 0s ease-in 5s forwards;-webkit-animation-fill-mode:forwards;animation:cssAnimation 0s ease-in 5s forwards;animation-fill-mode:forwards;background-color:hsla(0,0%,100%,.6);border-radius:12px;color:#757575;font-family:Roboto,RobotoDraft,Helvetica,Arial,sans-serif;font-size:34px;font-stretch:normal;font-style:normal;font-variant:normal;font-weight:400;height:auto;line-height:40px;margin-bottom:72px;padding:22px 0;text-align:center;visibility:visible;width:656px}@keyframes cssAnimation{to{height:0;overflow:hidden;width:0}}@-webkit-keyframes cssAnimation{to{height:0;visibility:hidden;width:0}}.drawCanvas[_ngcontent-%COMP%]{cursor:crosshair;left:0;margin:0 auto;position:absolute;top:0;z-index:-1}.pointerCursor[_ngcontent-%COMP%]{cursor:default!important}"]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(j,[{type:t.Component,args:[{selector:"feedback-dialog",templateUrl:"./feedback-dialog.component.html",styleUrls:["./feedback-dialog.component.css"]}]}],(function(){return[{type:r.MatDialogRef},{type:w},{type:t.ChangeDetectorRef},{type:t.ElementRef}]}),{screenshotParent:[{type:t.ViewChild,args:["screenshotParent"]}],onEscapeKeyDownHandler:[{type:t.HostListener,args:["document:keydown.escape",["$event"]]}]});var Y=function(){function e(e,n,o){var i=this;this.dialogRef=e,this.feedbackService=n,this.title="Send feedback",this.placeholder="Describe your issue or share your ideas",this.editTip="Click to highlight or hide info",this.checkboxLabel="Include screenshot",this.cancelLabel="CANCEL",this.sendLabel="SEND",this.moveToolbarTip="move toolbar",this.drawRectTip="Draw using yellow to highlight issues or black to hide sensitive info",this.highlightTip="highlight issues",this.hideTip="hide sensitive info",this.editDoneLabel="DONE",this.send=new t.EventEmitter,this.feedbackService.feedback$.subscribe((function(e){i.send.emit(e)})),this.overlay=o}return e.prototype.onClick=function(){this.openFeedbackDialog()},e.prototype.openFeedbackDialog=function(){this.feedbackService.initScreenshotCanvas(),this.dialogRef.open(j,{panelClass:"feedbackDialog",backdropClass:"dialogBackDrop",disableClose:!0,height:"auto",width:"auto",scrollStrategy:this.overlay.scrollStrategies.reposition()})},e.prototype.ngOnInit=function(){this.feedbackService.initialVariables={title:this.title,placeholder:this.placeholder,editTip:this.editTip,checkboxLabel:this.checkboxLabel,cancelLabel:this.cancelLabel,sendLabel:this.sendLabel,moveToolbarTip:this.moveToolbarTip,drawRectTip:this.drawRectTip,highlightTip:this.highlightTip,hideTip:this.hideTip,editDoneLabel:this.editDoneLabel}},e}();Y.ɵfac=function(e){return new(e||Y)(t.ɵɵdirectiveInject(r.MatDialog),t.ɵɵdirectiveInject(w),t.ɵɵdirectiveInject(u.Overlay))},Y.ɵdir=t.ɵɵdefineDirective({type:Y,selectors:[["","feedback",""]],hostBindings:function(e,n){1&e&&t.ɵɵlistener("click",(function(){return n.onClick()}))},inputs:{title:"title",placeholder:"placeholder",editTip:"editTip",checkboxLabel:"checkboxLabel",cancelLabel:"cancelLabel",sendLabel:"sendLabel",moveToolbarTip:"moveToolbarTip",drawRectTip:"drawRectTip",highlightTip:"highlightTip",hideTip:"hideTip",editDoneLabel:"editDoneLabel"},outputs:{send:"send"}}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(Y,[{type:t.Directive,args:[{selector:"[feedback]"}]}],(function(){return[{type:r.MatDialog},{type:w},{type:u.Overlay}]}),{title:[{type:t.Input}],placeholder:[{type:t.Input}],editTip:[{type:t.Input}],checkboxLabel:[{type:t.Input}],cancelLabel:[{type:t.Input}],sendLabel:[{type:t.Input}],moveToolbarTip:[{type:t.Input}],drawRectTip:[{type:t.Input}],highlightTip:[{type:t.Input}],hideTip:[{type:t.Input}],editDoneLabel:[{type:t.Input}],send:[{type:t.Output}],onClick:[{type:t.HostListener,args:["click"]}]});var X=function(){};X.ɵmod=t.ɵɵdefineNgModule({type:X}),X.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||X)},providers:[w],imports:[[r.MatDialogModule,i.MatButtonModule,s.MatIconModule,l.MatInputModule,d.MatTooltipModule,n.CommonModule,o.FormsModule,a.MatCheckboxModule,c.MatProgressSpinnerModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(X,{declarations:[j,S,R,Y],imports:[r.MatDialogModule,i.MatButtonModule,s.MatIconModule,l.MatInputModule,d.MatTooltipModule,n.CommonModule,o.FormsModule,a.MatCheckboxModule,c.MatProgressSpinnerModule],exports:[Y]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(X,[{type:t.NgModule,args:[{declarations:[j,S,R,Y],imports:[r.MatDialogModule,i.MatButtonModule,s.MatIconModule,l.MatInputModule,d.MatTooltipModule,n.CommonModule,o.FormsModule,a.MatCheckboxModule,c.MatProgressSpinnerModule],exports:[Y],entryComponents:[j],providers:[w]}]}],null,null),e.Feedback=v,e.FeedbackDirective=Y,e.FeedbackModule=X,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-feedback.umd.min.js.map